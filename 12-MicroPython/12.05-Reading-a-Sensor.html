

<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>13.1.5. Reading a Sensor &#8212; PSWP</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.min.css" integrity="sha384-KA6wR/X5RY4zFAHpv/CnoG2UW1uogYfdnP67Uv7eULvTveboZJg0qUpmJZb5VqzN" crossorigin="anonymous">
    <link href="../_static/css/index.css" rel="stylesheet">
    <link rel="stylesheet" href="../_static/sphinx-book-theme.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/jupyter-sphinx.css" />
    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/sphinx-book-theme.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/language_data.js"></script>
    <script src="../_static/togglebutton.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/mystnb.js"></script>
    <script src="../_static/sphinx-book-theme.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="https://unpkg.com/@jupyter-widgets/html-manager@^0.18.0/dist/embed-amd.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="canonical" href="http://l127.0.0.1:8500/12-MicroPython/12.05-Reading-a-Sensor.html" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="13.1.6. Uploading Code" href="12.06-Uploading-Code.html" />
    <link rel="prev" title="13.1.4. Blinking a LED" href="12.04-Blinking-a-LED.html" />

    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="docsearch:language" content="en">


<!-- Opengraph tags -->
<meta property="og:url"         content="http://l127.0.0.1:8500/12-MicroPython/12.05-Reading-a-Sensor.html" />
<meta property="og:type"        content="article" />
<meta property="og:title"       content="Reading a Sensor" />
<meta property="og:description" content="Reading a Sensor  In this section, you will learn how to connect a temperature sensor to an ESP8266-based microcontroller and use the MicroPython REPL to read t" />
<meta property="og:image"       content="http://l127.0.0.1:8500/_static/logo.png" />

<meta name="twitter:card" content="summary">


  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
<a class="navbar-brand text-wrap" href="../index.html">
  
  <img src="../_static/logo.png" class="logo" alt="logo">
  
  
  <h1 class="site-logo" id="site-title">PSWP</h1>
  
</a>
</div>

<form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form>

<nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
  <ul class="current nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../00-Preface/00.00-Motivation.html">
   1. Preface
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../01-Orientation/01.00-Welcome.html">
   2. Orientation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../02-Jupyter-Notebooks/02.00-Introduction.html">
   3. Jupyter Notebooks
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../03-The-Python-REPL/03.00-Introduction.html">
   4. The Python REPL
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../04-Data-Types-and-Variables/04.00-Introduction.html">
   5. Data Types and Variables
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../05-NumPy-and-Arrays/05.00-Introduction.html">
   6. NumPy and Arrays
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../06-Plotting-with-Matplotlib/06.00-Introduction.html">
   7. Plotting with Matplotlib
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../07-Functions-and-Modules/07.00-Introduction.html">
   8. Functions and Modules
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../08-If-Else-Try-Except/08.00-Introduction.html">
   9. If Else Try Except
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../09-Loops/09.00-Introduction.html">
   10. Loops
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../10-Symbolic-Math/10.00-Introduction.html">
   11. Symbolic Math
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../11-Python-and-External-Hardware/11.00-Introduction.html">
   12. Python and External Hardware
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="reference internal" href="12.00-Introduction.html">
   13. MicroPython
  </a>
  <ul class="current">
   <li class="toctree-l2">
    <a class="reference internal" href="12.01-What-is-MicroPython.html">
     13.1.1. What is MicroPython?
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="12.02-Installing-MicroPython.html">
     13.1.2. Installing MicroPython
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="12.03-MicroPython-REPL.html">
     13.1.3. The MicroPython REPL
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="12.04-Blinking-a-LED.html">
     13.1.4. Blinking a LED
    </a>
   </li>
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     13.1.5. Reading a Sensor
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="12.06-Uploading-Code.html">
     13.1.6. Uploading Code
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="12.07-Summary.html">
     13.1.7. Summary
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="12.08-Project-Ideas.html">
     13.1.8. Project Ideas
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../99-Appendix/99.00-Appendix.html">
   14. Appendix
  </a>
 </li>
</ul>

</nav>

 <!-- To handle the deprecated key -->

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="row topbar fixed-top container-xl">
    <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show">
    </div>
    <div class="col pl-2 topbar-main">
        
        <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
            data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
            aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
            title="Toggle navigation" data-toggle="tooltip" data-placement="left">
            <i class="fas fa-bars"></i>
            <i class="fas fa-arrow-left"></i>
            <i class="fas fa-arrow-up"></i>
        </button>
        
        <div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    
    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../_sources/12-MicroPython/12.05-Reading-a-Sensor.md"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.md</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
    
</div>
        <!-- Source interaction buttons -->


        <!-- Full screen (wrap in <a> to have style consistency -->
        <a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
                data-placement="bottom" onclick="toggleFullScreen()" title="Fullscreen mode"><i
                    class="fas fa-expand"></i></button></a>

        <!-- Launch buttons -->

    </div>

    <!-- Table of contents -->
    <div class="d-none d-md-block col-md-2 bd-toc show">
        <div class="tocsection onthispage pt-5 pb-3">
            <i class="fas fa-list"></i> On this page
        </div>
        <nav id="bd-toc-nav">
            <ul class="nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#summary-of-steps">
   13.1.5.1. Summary of Steps
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#connect-the-mcp9808-temperature-sensor-to-the-adafruit-feather-huzzah-esp8266-microcontroller">
   13.1.5.2. Connect the MCP9808 temperature sensor to the Adafruit Feather Huzzah ESP8266 microcontroller
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#connect-the-adafruit-feather-huzzah-esp8266-microcontroller-to-the-computer-with-a-usb-cable-and-bring-up-the-micropython-repl-with-putty">
   13.1.5.3. Connect the Adafruit Feather Huzzah ESP8266 microcontroller to the computer with a USB cable and bring up the MicroPython REPL with PuTTY
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#run-code-at-the-micropython-repl-to-measure-the-temperature">
   13.1.5.4. Run code at the MicroPython REPL to measure the temperature
  </a>
 </li>
</ul>

        </nav>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="reading-a-sensor">
<h1><span class="section-number">13.1.5. </span>Reading a Sensor<a class="headerlink" href="#reading-a-sensor" title="Permalink to this headline">¶</a></h1>
<p>In this section, you will learn how to connect a temperature sensor to an ESP8266-based microcontroller and use the MicroPython REPL to read the temperature. This section includes specifics for the Adafruit Feather Huzzah ESP8266 microcontroller and the <a class="reference external" href="https://www.adafruit.com/product/1782">MCP9808 temperature sensor</a>. Other ESP8266-based microcontrollers and temperature sensors could be used instead, but the specifics of the procedure may be different from what’s shown in this section.</p>
<p>Before you can use MicroPython to read a temperature sensor, MicroPython needs to be installed on the board, and PuTTY needs to be installed on your computer (on MacOS and Linux, use a terminal and  <code class="docutils literal notranslate"><span class="pre">screen</span></code>) to communicate with the board over serial.</p>
<div class="section" id="summary-of-steps">
<h2><span class="section-number">13.1.5.1. </span>Summary of Steps<a class="headerlink" href="#summary-of-steps" title="Permalink to this headline">¶</a></h2>
<ol class="simple">
<li><p>Connect the MCP9808 temperature sensor to the Adafruit Feather Huzzah ESP8266 microcontroller</p></li>
<li><p>Connect the Adafruit Feather Huzzah ESP8266 microcontroller to the computer with a USB cable and bring up the MicroPython REPL with PuTTY</p></li>
<li><p>Run code at the MicroPython REPL to measure the temperature</p></li>
</ol>
</div>
<div class="section" id="connect-the-mcp9808-temperature-sensor-to-the-adafruit-feather-huzzah-esp8266-microcontroller">
<h2><span class="section-number">13.1.5.2. </span>Connect the MCP9808 temperature sensor to the Adafruit Feather Huzzah ESP8266 microcontroller<a class="headerlink" href="#connect-the-mcp9808-temperature-sensor-to-the-adafruit-feather-huzzah-esp8266-microcontroller" title="Permalink to this headline">¶</a></h2>
<p>Connect the <a class="reference external" href="https://www.adafruit.com/product/1782">MCP9808 temperature sensor</a> breakout board to the Adafruit Feather Huzzah ESP8266 microcontroller with jumper wires. There are four connections: A 3V power line from the Feather Huzzah to the MCP9808 Vdd pin, GND connected between both boards, and the I2C data and clock lines connected between the two boards. On the Feather Huzzah ESP8266, the I2C data line is SDA (pin 4) and the I2C clock line is SCL (pin 5). These pins on the microcontroller connect with the MPC9808 I2C data line SDA and the MPC9808 I2C clock line SCL. Unlike serial communication where RX connects to TX, in I2C communication SDA connects to SDA and SCL connects to SCL.</p>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="head"><p>Feather Huzzah</p></th>
<th class="head"><p>wire</p></th>
<th class="head"><p>MCP9808</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>3V</p></td>
<td><p>red</p></td>
<td><p>Vdd</p></td>
</tr>
<tr class="row-odd"><td><p>GND</p></td>
<td><p>black</p></td>
<td><p>GND</p></td>
</tr>
<tr class="row-even"><td><p>SDA (pin 4)</p></td>
<td><p>green</p></td>
<td><p>SDA</p></td>
</tr>
<tr class="row-odd"><td><p>SCL (pin 5)</p></td>
<td><p>yellow</p></td>
<td><p>SCL</p></td>
</tr>
</tbody>
</table>
<p><img alt="MCP9808 temperature sensor connected to an Adafruit Feather Huzzah ESP8266" src="../_images/feather_huzzah_temp_sensor_fritzing.png" /></p>
</div>
<div class="section" id="connect-the-adafruit-feather-huzzah-esp8266-microcontroller-to-the-computer-with-a-usb-cable-and-bring-up-the-micropython-repl-with-putty">
<h2><span class="section-number">13.1.5.3. </span>Connect the Adafruit Feather Huzzah ESP8266 microcontroller to the computer with a USB cable and bring up the MicroPython REPL with PuTTY<a class="headerlink" href="#connect-the-adafruit-feather-huzzah-esp8266-microcontroller-to-the-computer-with-a-usb-cable-and-bring-up-the-micropython-repl-with-putty" title="Permalink to this headline">¶</a></h2>
<p>Connect the Adafruit Feather Huzzah ESP8266 to the computer with a microUSB cable. Ensure the cable is a USB data cable, not just a power cable. Open PuTTY and connect to the Feather Huzzah using the proper serial port (COM#) and 115200 baud. (Remember to use the <strong>Serial</strong> radio button under <strong>Connection Type:</strong>)</p>
<p><img alt="PuTTY in the Windows 10 Start Menu" src="../_images/putty_in_start_menu.png" /></p>
<p><img alt="PuTTY Configuration" src="../_images/putty_config.PNG" /></p>
<p>Clicking [Open] will bring up the MicroPython REPL prompt <code class="docutils literal notranslate"><span class="pre">&gt;&gt;&gt;</span></code>. If you can’t see the <code class="docutils literal notranslate"><span class="pre">&gt;&gt;&gt;</span></code> prompt, try typing [Enter] or [Ctrl]+[D] or push the RESET button on the Feather Huzzah. If none of these methods work, try closing PuTTY and unplugging then replugging in the USB cable then reopen PuTTY.</p>
</div>
<div class="section" id="run-code-at-the-micropython-repl-to-measure-the-temperature">
<h2><span class="section-number">13.1.5.4. </span>Run code at the MicroPython REPL to measure the temperature<a class="headerlink" href="#run-code-at-the-micropython-repl-to-measure-the-temperature" title="Permalink to this headline">¶</a></h2>
<p>At the MicroPython REPL, import the <code class="docutils literal notranslate"><span class="pre">machine</span></code> module and then create an instance of the <code class="docutils literal notranslate"><span class="pre">machine.I2C</span></code> class. Set the <code class="docutils literal notranslate"><span class="pre">scl</span></code> and <code class="docutils literal notranslate"><span class="pre">sda</span></code> parameters as <code class="docutils literal notranslate"><span class="pre">scl=machine.Pin(5)</span></code> and <code class="docutils literal notranslate"><span class="pre">sda=machine.Pin(4)</span></code>.  Next, create an empty <code class="docutils literal notranslate"><span class="pre">bytearray</span></code> to store the data coming in from the MCP9808 temperature sensor. As strings in Micropython are UTF-8 encoded by default (like in Python 3), a <em>bytearray</em> needs to be used to read the raw output from the MCP9808 chip registers. The command <code class="docutils literal notranslate"><span class="pre">i2c.readfrom_mem_into()</span></code> reads the data from the sensor and saves it to the <code class="docutils literal notranslate"><span class="pre">byte_data</span></code> variable. The arguments inside the <code class="docutils literal notranslate"><span class="pre">i2c.readfrom_mem_into()</span></code> method <code class="docutils literal notranslate"><span class="pre">24</span></code> and <code class="docutils literal notranslate"><span class="pre">5</span></code> correspond to the I2C memory address and registry address of the temperature data stored in the MCP9808 temperature sensor.</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>&gt;&gt;&gt; import machine
&gt;&gt;&gt; i2c = machine.I2C(scl=machine.Pin(5), sda=machine.Pin(4))
&gt;&gt;&gt; byte_data = bytearray(2)
&gt;&gt;&gt; i2c.readfrom_mem_into(24, 5, byte_data)
&gt;&gt;&gt; value = byte_data[0] &lt;&lt; 8 | byte_data[1]
&gt;&gt;&gt; temp = (value &amp; 0xFFF) / 16.0
&gt;&gt;&gt; if value &amp; 0x1000:
...     temp -= 256.0
.....   print(temp)
</pre></div>
</div>
</div>
</div>


              </div>
              
        </div>
    </div>
    
    
    <div class='prev-next-bottom'>
        
    <a class='left-prev' id="prev-link" href="12.04-Blinking-a-LED.html" title="previous page"><span class="section-number">13.1.4. </span>Blinking a LED</a>
    <a class='right-next' id="next-link" href="12.06-Uploading-Code.html" title="next page"><span class="section-number">13.1.6. </span>Uploading Code</a>

    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By Peter D. Kazarinoff, PhD<br/>
        
            &copy; Copyright 2020.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>

    <script src="../_static/js/index.js"></script>
    
  </body>
</html>